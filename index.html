<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Book Category Ranker</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Load Inter font -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .draggable-item.dragging {
            opacity: 0.5;
            background-color: #ebf8ff; /* Tailwind's blue-50 */
            border: 1px dashed #3182ce; /* Tailwind's blue-600 */
        }
        
        /* --- ADDED: CSS Counter for numbering --- */
        #sortable-list {
            /* 1. Initializes the counter "rank" to 0 for this container */
            counter-reset: rank;
        }

        .draggable-item::before {
            /* 2. Increments the "rank" counter for each item */
            counter-increment: rank;
            
            /* 3. Displays the current value of "rank" */
            content: counter(rank);

            /* 4. Styling for the number */
            color: #a0aec0; /* Tailwind's gray-500 */
            font-weight: 600;
            font-size: 1rem; /* text-base */
            width: 2.5rem;   /* Fixed width for alignment */
            flex-shrink: 0;  /* Prevents the number from shrinking */
            text-align: right;
            padding-right: 1rem; /* Space between number and text */
        }
     
    </style>
</head>
<body class="bg-gray-100 p-4 pt-8 sm:pt-12">

    <form id="ranking-form" class="bg-white p-6 sm:p-8 rounded-2xl shadow-lg w-full max-w-lg mx-auto">
        
        <h1 class="text-2xl sm:text-3xl font-bold text-center text-gray-800 mb-6">
            Book Club Category Survey
        </h1>

        <!-- Step 1: Draggable List -->
        <div class="mb-6">
            <label class="block text-sm font-medium text-gray-700 mb-2">Please put the categories in order of </br>  favourite (1) to least favourite (19)</label>
            <div id="sortable-list" class="border border-gray-200 rounded-lg p-3 space-y-2 bg-gray-50">
                <!-- Items will be dynamically inserted here -->
            </div>
        </div>

        <!-- Step 2: Submit Button -->
        <button id="submit-btn" type="submit" class="w-full bg-blue-600 text-white font-bold py-3 px-6 rounded-lg shadow-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-50 transition-all duration-200 ease-in-out transform hover:-translate-y-0.5 disabled:opacity-50 disabled:cursor-not-allowed">
            Submit Rankings
        </button>

        <!-- Message Box for feedback -->
        <div id="message-box" class="mt-4 text-center text-sm font-medium hidden"></div>

    </form>

    <script>
        // --- CONFIGURATION ---
        
        // Your Formspree endpoint URL
        const FORM_ENDPOINT = "https://formspree.io/f/mwprgdap";
        
        // Define the items to be ranked
        const ITEMS_TO_RANK = [
            "Action packed",
            "Science Fiction",
            "Book in Translation",
            "\"Weird\" Fiction",
            "Retellings (fairytales)",
            "Book You \"Should\" Have Read (or pretend to have read)",
            "Horror - lite",
            "Timey Wimey Wibbly-Wobbly (books that play around with time)",
            "A Twist on a Classic",
            "Locked Room Mystery",
            "Queer Norm",
            "Unreliable/ Unlikable Narrator",
            "Anything written by T.Kingfisher",
            "Short Fiction (less than 250 pages)",
            "Vetted Romance (a \"banger\" in terms of plot, but not necessarily spicy)",
            "Last Best Book You read",
            "Oldest Book on Your TBR",
            "Bookish Books for Book People",
            "A Book You Loved, But Cannot Remember the Plot"
        ];
        
        // --- APPLICATION LOGIC ---
        
        document.addEventListener('DOMContentLoaded', () => {
            const listContainer = document.getElementById('sortable-list');
            const form = document.getElementById('ranking-form');
            const submitButton = document.getElementById('submit-btn');
            const messageBox = document.getElementById('message-box');
            
            let draggingItem = null;

            // 1. Populate the list
            function createItemElement(text) {
                const item = document.createElement('div');
                // The "cursor-move" class is still present, so users know it's draggable
                item.className = 'draggable-item bg-white p-3 rounded-lg shadow-sm flex items-center cursor-move border border-gray-200';
                item.draggable = true;
                
                // --- REMOVED: Drag handle element creation ---
                
                const itemText = document.createElement('span');
                itemText.className = 'item-text text-gray-800';
                itemText.textContent = text;
                
                item.appendChild(itemText);
                return item;
            }
            
            ITEMS_TO_RANK.forEach(text => {
                listContainer.appendChild(createItemElement(text));
            });

            // 2. Drag and Drop Listeners
            listContainer.addEventListener('dragstart', (e) => {
                if (e.target.classList.contains('draggable-item')) {
                    draggingItem = e.target;
                    setTimeout(() => draggingItem.classList.add('dragging'), 0);
                    e.dataTransfer.effectAllowed = 'move';
                }
            });

            listContainer.addEventListener('dragend', (e) => {
                if (draggingItem) {
                    draggingItem.classList.remove('dragging');
                    draggingItem = null;
                }
            });

            listContainer.addEventListener('dragover', (e) => {
                e.preventDefault(); 
                if (!draggingItem) return;
                const afterElement = getDragAfterElement(listContainer, e.clientY);
                if (afterElement == null) {
                    listContainer.appendChild(draggingItem);
                } else {
                    listContainer.insertBefore(draggingItem, afterElement);
                }
            });
            
            function getDragAfterElement(container, y) {
                const draggableElements = [...container.querySelectorAll('.draggable-item:not(.dragging)')];
                return draggableElements.reduce((closest, child) => {
                    const box = child.getBoundingClientRect();
                    const offset = y - box.top - box.height / 2;
                    if (offset < 0 && offset > closest.offset) {
                        return { offset: offset, element: child };
                    } else {
                        return closest;
                    }
                }, { offset: Number.NEGATIVE_INFINITY }).element;
            }

            // 3. Handle Form Submission
            form.addEventListener('submit', async (e) => {
                e.preventDefault(); // Stop the form from submitting normally
                
                // Disable button
                submitButton.disabled = true;
                submitButton.textContent = 'Submitting...';
                showMessage('Sending your rankings...', 'info');

                // Get the ranked items
                const items = listContainer.querySelectorAll('.item-text');
                const rankedList = Array.from(items).map((item, index) => {
                    // The numbering here is for the final email text
                    return `${index + 1}. ${item.textContent}`;
                });

                // Create the data payload
                const formData = {
                    rankings: rankedList.join('\n') // Send as a single string for easy reading in email
                };

                // Send the data to Formspree
                try {
                    const response = await fetch(FORM_ENDPOINT, {
                        method: 'POST',
                        body: JSON.stringify(formData),
                        headers: {
                            'Content-Type': 'application/json',
                            'Accept': 'application/json'
                        }
                    });

                    if (response.ok) {
                        showMessage('Success! Your rankings have been submitted.', 'success');
                        submitButton.textContent = 'Submitted!';
                    } else {
                        throw new Error('Form submission failed.');
                    }
                } 
            });
            
            // Helper function to show messages
            function showMessage(text, type) {
                messageBox.textContent = text;
                messageBox.classList.remove('hidden', 'text-red-600', 'text-green-600', 'text-gray-700');
                
                if (type === 'error') {
                    messageBox.classList.add('text-red-600');
                } else if (type === 'success') {
                    messageBox.classList.add('text-green-600');
S                } else {
                    messageBox.classList.add('text-gray-700'); // For 'info'
                }
            }
        });
    </script>
</body>
</html>

